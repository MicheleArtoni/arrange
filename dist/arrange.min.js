/*! arrange - v0.0.1 - 2014-09-24
* Copyright (c) 2014 ; Licensed  */
this.arrange=function(a){"use strict";function b(a){return null==a}function c(a,c){return b(a)?c:a}function d(a){var b=a.charAt(0);return a.slice(1,-1).replace(b+b,b)}function e(a,c,d){return a=a.toString(),a.length>=c?a:(b(d)&&(d=" "),new Array(c-a.length+1).join(d||" ")+a)}function f(a,c,d){return a=a.toString(),a.length>=c?a:(b(d)&&(d=" "),a+new Array(c-a.length+1).join(d||" "))}function g(a,b){for(var c=0;c<a.length;c++)if(a[c]===b)return!0;return!1}function h(a){return a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function i(a){if(null===a)return"null";var b=typeof a;return"object"!==b?b:r.call(a).slice(8,-1).toLowerCase()}function j(a,b){if(!a)return b;if(t[a])return t[a];var c=a.match(/^([A-Z]+)(?:[_-]([A-Z]+))?$/i);if(c){var d=c[1].toLowerCase(),e=c[2]?"_"+c[2].toUpperCase():"";if(t[d+e])return t[d+e];if(t[d])return t[d]}return b}function k(a){a=c(a,{}),this.openChar=c(a.openChar,u.openChar),this.closeChar=c(a.closeChar,u.closeChar),this.valueFormatters=c(a.valueFormatters,[]).concat(u.valueFormatters),this.localeInfo=j(a.locale,u.localeInfo),this.templateCache=a.noCache?null:{};var b=h(this.openChar),d=h(this.closeChar),e=b+b,f=d+d,g="[a-zA-Z$_][a-zA-Z$_0-9]*",i="[+-]?[0-9]+",k="'(?:[^']|'')*'",l='"(?:[^"]|"")*"',m="(?:"+k+"|"+l+")",n="(?:"+g+"|"+i+"|"+m+")",o="(?:\\s*\\.\\s*)",p="(?:"+o+"?"+n+"(?:"+o+n+")*)?",q="(?:,[+-]?[0-9]+)?",r="(?::(?:[^"+b+d+"]|"+e+"|"+f+")+)?",s=b+"\\s*"+p+"\\s*"+q+"\\s*"+r+"\\s*"+d,t=b+"\\s*("+p+")\\s*("+q+")\\s*("+r+")\\s*"+d;this.expressionRx=new RegExp(t),this.keyRx=new RegExp(n,"g");var v="("+e+"|"+f+"|"+s+")";this.tokenRx=new RegExp(v,"g")}function l(a,b){this.tokens=a,this.localeInfo=b}function m(a,b){this._template=a,this._args=b}function n(a){this._template=a}function o(a,b){this._formatter=a,this._args=b}function p(a){var b=new k(a),c=function(a){var c=q.call(arguments,1);return b.Parse(a).ApplyArray(c)};return c._formatter=b,c.newArrange=function(a){return p(a)},c.lazy=function(a){var c=q.call(arguments,1);return new m(b.Parse(a),c)},c.template=function(a){return new n(b.Parse(a))},c.formattable=function(){var a=q.call(arguments,0);return new o(b,a)},c}if("undefined"!=typeof a)return a;var q=Array.prototype.slice,r=Object.prototype.toString,s=String.prototype.trim?function(a){return a.trim()}:function(a){return a.replace(/^\s+|\s+$/g,"")},t={en:{locale:"en",ampm:["AM","PM"],months:"January February March April May June July August September October November December".split(" "),monthsShort:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),day:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),dayShort:"Sun Mon Tue Wed Thu Fri Sat".split(" ")},it:{locale:"it",ampm:["AM","PM"],months:"gennaio febbraio marzo aprile maggio giugno luglio agosto settembre ottoble novembre dicembre".split(" "),monthsShort:"gen feb mar apr mag giu lug ago set ott nov dic".split(" "),day:"domenica lunedì martedì mercoledì giovedì venerdì sabato".split(" "),dayShort:"dom lun mar mer gio ven sab".split(" ")}},u={openChar:"{",closeChar:"}",localeInfo:j("en"),valueFormatters:[{name:"NumberFormat",argumentsRegexp:/^([BDEFGOPX])(\+?[0-9]+)?\s*$/i,allowedTypes:["number","string"],processMatch:function(a){var b,c=!1;return a[2]&&(c="+"===a[2].charAt(0),b=parseInt(a[2],10)),{code:a[1],parameter:b,alwaysShowSign:c}},formatValue:function(a,b,c){var d="number"===b?a:parseFloat(a);if(d!==d)return"NaN";if(d===1/0)return c.alwaysShowSign?"+Infinity":"Infinity";if(d===-1/0)return"-Infinity";var f,g=c.code.toUpperCase(),h=g===c.code;if("D"===g||"X"===g||"B"===g||"O"===g){var i=Math.round(d),j=c.parameter||0,k="D"===g?10:"X"===g?16:"B"===g?2:8;f=0>i?"-"+e((-i).toString(k),j,"0"):c.alwaysShowSign?"+"+e(i.toString(k),j,"0"):e(i.toString(k),j,"0")}else{if("E"===g)f=d.toExponential(c.parameter);else if("F"===g)f=d.toFixed(c.parameter);else if("P"===g)f=d.toPrecision(c.parameter);else{var l=d.toExponential(c.parameter),m=d.toPrecision(c.parameter);f=l.length<m.length?l:m}var n=d?d>0:1/d>0;c.alwaysShowSign&&(n?f="+"+f:"-"!==f.charAt(0)&&(f="-"+f))}return h?f.toUpperCase():f.toLowerCase()}},{name:"JsonFormat",argumentsRegexp:/^JS(?:ON)?\s*([+-]?[0-9]+|"(?:[^"]|"")*"|'(?:[^']|'')*')?\s*$/i,allowedTypes:null,processMatch:function(a){if(!a[1])return null;var b=s(a[1]);return/^['"]/.test(b)?d(b):parseInt(b,10)},formatValue:function(a,c,d){try{var e=b(d)?void 0:d,f=JSON.stringify(a,void 0,e);return b(f)?a.toString():f}catch(g){return a.toString()}}},{name:"ToStringFormat",argumentsRegexp:/^S\s*$/i,allowedTypes:null,formatValue:function(a){return null===a?"":a.toString()}},{name:"DateFormat",argumentsRegexp:/^[\s\S]+$/,allowedTypes:["date"],elementsRegexp:/(%?d{1,4}|M{1,4}|f{1,3}|F{1,3}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|t{1,2}|[K:\/]|y{1,5}|z{1,3}|"(?:[^"]|"")*"|'(?:[^']|'')*')/,processMatch:function(a){for(var b=a[0].split(this.elementsRegexp),c=[],e=0;e<b.length;e++){var f;if(-1===b[e].search(this.elementsRegexp))f=b[e];else{var g=b[e];"%"===g.charAt(0)&&(g=g.slice(1)),f=/^['"]/.test(g)?d(g):{element:g.charAt(0),count:g.length}}""!==f&&("string"==typeof c[c.length-1]&&"string"==typeof f?c[c.length-1]+=f:c.push(f))}return c},formatValue:function(a,c,d,f){var g="date"!==c?new Date(a):a,h=g.getTime();if(h!==h)return null;for(var i=[],j=0;j<d.length;j++){var k=d[j],l=null;if("string"==typeof k)l=k;else{var m,n,o;switch(k.element){case"d":l=k.count<=2?e(g.getDate(),k.count,"0"):3===k.count?f.dayShort[g.getDay()]:f.day[g.getDay()];break;case"M":l=k.count<=2?e(g.getMonth()+1,k.count,"0"):3===k.count?f.monthsShort[g.getMonth()]:f.months[g.getMonth()];break;case"f":l=e(Math.floor(g.getMilliseconds()*Math.pow(10,k.count-3)),k.count,"0");break;case"F":l=e(Math.floor(g.getMilliseconds()*Math.pow(10,k.count-3)),k.count,"0"),l=l.replace(/0+$/,"")||"0";break;case"h":var p=g.getHours();l=e(0===p?12:p>12?p-12:p,k.count,"0");break;case"H":l=e(g.getHours(),k.count,"0");break;case"m":l=e(g.getMinutes(),k.count,"0");break;case"s":l=e(g.getSeconds(),k.count,"0");break;case"t":l=f.ampm[g.getHours()<12?0:1].substr(0,k.count);break;case"K":var q=g.toString().match(/\(.+\)/);q?l=q[0].slice(1,-1):(m=g.getTimezoneOffset(),n=0>m?"-":"+",l=n+e(Math.floor(m/60),2,"0")+":"+e(m%60,2,"0"));break;case":":l=":";break;case"/":l="/";break;case"y":o=g.getFullYear(),l=0>o?"-":"",o=Math.abs(o),l+=k.count>2?e(o,k.count,"0"):e(o%100,k.count,"0");break;case"z":m=g.getTimezoneOffset(),l=0>m?"-":"+",m=Math.abs(m),l+=e(Math.floor(m/60),k.count,"0"),3===k.count&&(l+=":"+e(m%60,2,"0"));break;default:l=k}}b(l)||""===l||i.push(l)}return i.join("")}},{name:"DefaultFormat",argumentsRegexp:null,allowedTypes:null,formatValue:function(a,c){switch(c){case"string":return a;case"number":case"boolean":case"date":return a.toString()}try{var d=JSON.stringify(a);return b(d)?a.toString():d}catch(e){return a.toString()}}}]};return k.prototype.ParseSelector=function(a){if(a=s(a||""),""===a)return{selector:[],isProperty:!1};for(var b=a.match(this.keyRx)||[],c=0;c<b.length;c++)b[c]=s(b[c]),/^[0-9+-]/.test(b[c])?b[c]=parseInt(b[c],10):/^['"]/.test(b[c])&&(b[c]=d(b[c]));var e="."===a.charAt(0)||"string"==typeof b[0];return{selector:b,isProperty:e}},k.prototype.ParseAlignement=function(a){return b(a)||""===a?0:parseInt(a.slice(1),10)},k.prototype.ParseFormat=function(a){if(a=(a||"").slice(1),""===a)return[];a=a.replace(this.openChar+this.openChar,this.openChar),a=a.replace(this.closeChar+this.closeChar,this.closeChar);for(var b=[],c=0;c<this.valueFormatters.length;c++){var d=this.valueFormatters[c],e=d.argumentsRegexp?a.match(d.argumentsRegexp):[a];if(e){var f=d.processMatch?d.processMatch(e):e;"undefined"!=typeof f&&b.push({formatter:d,formatArgs:f})}}return b},k.prototype.ParseExpression=function(a){var b=a.match(this.expressionRx),c=this.ParseSelector(b[1]);return{selector:c.selector,isProperty:c.isProperty,alignement:this.ParseAlignement(b[2]),possibleFormatters:this.ParseFormat(b[3])}},k.prototype.Parse=function(a){if(!b(this.templateCache)&&this.templateCache[a])return this.templateCache[a];for(var c=a.split(this.tokenRx),d=[],e=0;e<c.length;e++){var f;f=c[e]===this.openChar+this.openChar?this.openChar:c[e]===this.closeChar+this.closeChar?this.closeChar:c[e].charAt(0)===this.openChar&&c[e].slice(-1)===this.closeChar?this.ParseExpression(c[e]):c[e],"string"==typeof d[d.length-1]&&"string"==typeof f?d[d.length-1]+=f:d.push(f)}var g=new l(d,this.localeInfo);return null!==this.templateCache&&(this.templateCache[a]=g),g},l.prototype.ApplyArray=function(a){for(var c=[0],d=[],e=0;e<this.tokens.length;e++){var f=this.tokens[e],g=null;"string"==typeof f?g=f:(g=this.ApplyExpression(a,f.selector,f.isProperty,c),g=this.ApplyFormat(g,f.possibleFormatters),g=this.ApplyAlignment(g,f.alignement)),b(g)||""===g||d.push(g)}return d.join("")},l.prototype.ApplyExpression=function(a,c,d,e){var f;if(d){for(var g=0;g<a.length;g++)if(f=this.ApplyExpression(a[g],c,!1,e),"undefined"!=typeof f)return f;return f}if(0===c.length)return f=this.ApplyExpression(a,e,!1,e),e[0]++,f;f=a;for(var h=0;h<c.length&&!b(f);h++)f=f[c[h]];return f},l.prototype.ApplyFormat=function(a,c){if(b(a))return null;for(var d=i(a),e=0;e<c.length;e++){var f=c[e].formatter;if(b(f.allowedTypes)||-1!==g(f.allowedTypes,d)){var h=null;if(f.formatValue&&(h=f.formatValue(a,d,c[e].formatArgs,this.localeInfo)),!b(h))return h}}return a.toString()},l.prototype.ApplyAlignment=function(a,c){return b(a)?null:0===c?a:0>c?f(a,-c):e(a,c)},m.prototype.toString=function(){return this._template.ApplyArray(this._args)},n.prototype.arrange=function(){var a=q.call(arguments,0);return this._template.ApplyArray(a)},n.prototype.lazy=function(){var a=q.call(arguments,0);return new m(this._template,a)},o.prototype.arrange=function(a){return this._formatter.Parse(a).ApplyArray(this._args)},o.prototype.lazy=function(a){return new m(this._formatter.Parse(a),this._args)},p()}(this.arrange);